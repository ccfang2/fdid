<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making Event Study Plots Honest: A Functional Data Approach to Causal Inference. â€¢ fdid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Making Event Study Plots Honest: A Functional Data Approach to Causal Inference.">
<meta property="og:description" content="We present a novel functional data perspective on DiD that allows for honest causal inference using event study plots.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">fdid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="fdid-">fdid <img src="reference/figures/fdid_badge.png" align="right" alt="" width="155"><a class="anchor" aria-label="anchor" href="#fdid-"></a>
</h1></div>
<p><a href="https://makeapullrequest.com" class="external-link"><img src="https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square" alt="PRs Welcome"></a> <img src="https://img.shields.io/github/last-commit/ccfang2/fdid?logo=GitHub" alt="GitHub last commit"><img src="https://img.shields.io/github/repo-size/ccfang2/fdid?logo=GitHub" alt="GitHub repo size"><img src="https://img.shields.io/github/r-package/v/ccfang2/fdid?logo=R" alt="GitHub R package version"><img src="https://img.shields.io/github/stars/ccfang2/fdid?style=social" alt="GitHub Repo stars"></p>
<blockquote>
<p>The R package <code>fdid</code> allows users to implement the method proposed in Fang and Liebl (2025)<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. In this paper, we present a novel functional perspective on Difference-in-Differences (DiD) that allows for honest inference using event study plots under violations of parallel trends and/or no-anticipation assumptions. We use the algorithm of so-called fast and fair simultaneous confidence band from Liebl and Reimherr (2023)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> to construct the simultaneous band in our plots.</p>
</blockquote>
<blockquote>
<p>You may find a presentation of the paper in my YouTube <a href="https://www.youtube.com/watch?v=h0KCv8y9Apw" class="external-link">video</a>. Also, users can adjust their honest reference bands (see below) interactively via our <a href="https://ccfang2.shinyapps.io/fdidHonestInference/" class="external-link">Shiny app</a>.</p>
</blockquote>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>fdid</code> from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ccfang2/fdid"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-1-classical-simultaneous-causal-inference">Example 1: Classical Simultaneous Causal Inference<a class="anchor" aria-label="anchor" href="#example-1-classical-simultaneous-causal-inference"></a>
</h2>
<p>We hereby use event study estimates from Gallagher (2014)<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> as an example.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">fdid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Gdata</span><span class="op">)</span></span>
<span><span class="va">fdid_scb_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fdid_scb.html">fdid_scb</a></span><span class="op">(</span>beta<span class="op">=</span><span class="va">Gdata</span><span class="op">$</span><span class="va">beta</span>, cov<span class="op">=</span><span class="va">Gdata</span><span class="op">$</span><span class="va">cov</span>, t0<span class="op">=</span><span class="va">Gdata</span><span class="op">$</span><span class="va">t0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fdid_scb_est</span>, pos.legend<span class="op">=</span><span class="st">"bottom"</span>, scale.legend<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<p>We first load the data from our package, and then we use the function <code><a href="reference/fdid_scb.html">fdid_scb()</a></code> to compute simultaneous confidence band from using the estimates of event study coefficients, covariances and reference time point, and finally we use the generic function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> to derive a figure as follows.</p>
<p align="center">
<img src="reference/figures/plot_scb.png" width="50%"></p>
<p>As is seen, the reference time in this example is at event time -1. The gray area indicates the time span over which the treatment effect is uniformly significant under our simultaneous confidence band. Traditional confidence intervals are also plotted. The intervals fail to take into account the multiple testing problem, so they are typically narrower than our band.</p>
<p>If you do not have estimates of event study coefficients and covariances, you may use our function <code><a href="reference/fdid.html">fdid()</a></code> to estimate them from using your original data. Our function allows the estimation under both non-staggered and staggered DiD designs. In particularly, we consider the negative weighting problem of estimating event study coefficients under staggered designs and use carefully chosen non-negative weights to sum up estimates from different treatment subgroups.</p>
</div>
<div class="section level2">
<h2 id="example-2-honest-causal-inference-under-treatment-anticipation-with-reference-band">Example 2: Honest Causal Inference under Treatment Anticipation with Reference Band<a class="anchor" aria-label="anchor" href="#example-2-honest-causal-inference-under-treatment-anticipation-with-reference-band"></a>
</h2>
<p>Following Example 1, we now suppose that, right after event time -3, there is an anticipation of treatment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fdid_scb_est</span>, ta.t0<span class="op">=</span><span class="op">-</span><span class="fl">3</span>, pos.legend<span class="op">=</span><span class="st">"bottom"</span>, scale.legend<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="reference/figures/plot_scb_ta.png" width="50%"></p>
<p>With an anticipation right after event time -3, one may see the time span over which the treatment effect is uniformly significant shrinks. Under treatment anticipation, the null hypothesis for our test includes all values within the pink bounds.</p>
</div>
<div class="section level2">
<h2 id="example-3-honest-causal-inference-under-differential-trends-with-relative-magnitudes-reference-band">Example 3: Honest Causal Inference under Differential Trends with Relative Magnitudes Reference Band<a class="anchor" aria-label="anchor" href="#example-3-honest-causal-inference-under-differential-trends-with-relative-magnitudes-reference-band"></a>
</h2>
<p>Following Example 1, we now suppose that, there is differential trend of relative magnitudes with control parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>M</mi><mo accent="true">Â¯</mo></mover><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\overline{M}=1</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fdid_scb_est</span>, frm.mbar<span class="op">=</span><span class="fl">1</span>, pos.legend<span class="op">=</span><span class="st">"bottom"</span>, scale.legend<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="reference/figures/plot_scb_frm.png" width="50%"></p>
<p>Under such a differential trend, the time span over which the treatment effect is uniformly significant is even smaller. It can be seen that the average absolute derivative of functional DiD estimate over pre-treatment time is quite large, so our bounds for honest inference is also large.</p>
</div>
<div class="section level2">
<h2 id="example-4-honest-inference-under-differential-trends-with-trend-restrictions-reference-band">Example 4: Honest Inference under Differential Trends with Trend Restrictions Reference Band<a class="anchor" aria-label="anchor" href="#example-4-honest-inference-under-differential-trends-with-trend-restrictions-reference-band"></a>
</h2>
<p>Following Example 1, we now suppose that, there is differential trend of trend restrictions with control parameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">M=2</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fdid_scb_est</span>, ftr.m<span class="op">=</span><span class="fl">2</span>, pos.legend<span class="op">=</span><span class="st">"bottom"</span>, scale.legend<span class="op">=</span><span class="fl">1.4</span><span class="op">)</span></span></code></pre></div>
<p align="center">
<img src="reference/figures/plot_scb_ftr.png" width="50%"></p>
<p>With this specific differential trend, the time span over which the treatment effect is uniformly significant is not so different from that without. It can be seen that the pre-trend, measured by the average of derivative of functional DiD estimate over pre-treatment time, is quite small. Hence, the inference result does not change too much from Example 1, even though the control parameter is not infinitesimal.</p>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>Chencheng Fang, Email: <a href="mailto:ccfang@uni-bonn.de">ccfang[at]uni-bonn.de</a>, Institute of Finance and Statistics, University of Bonn</p>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Fang, C. and Liebl, D. (2025). Making Event Study Plots Honest: A Functional Data Approach to Causal Inference. Working Paper<a href="#fnref1" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn2"><p>Liebl, D. and M. Reimherr (2023). Fast and fair simultaneous confidence bands for functional parameters. Journal of the Royal Statistical Society Series B: Statistical Methodology 85(3), 842â€“868<a href="#fnref2" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn3"><p>Gallagher, J. (2014). Learning about an Infrequent Event: Evidence from Flood Insurance Take-Up in the United States. American Economic Journal: Applied Economics 6(3), 206â€“33.<a href="#fnref3" class="footnote-back">â†©ï¸Ž</a></p></li>
</ol>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 3)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing fdid</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Chencheng Fang <br><small class="roles"> Author, maintainer </small>  </li>
<li>Dominik Liebl <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Chencheng Fang, Dominik Liebl.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
